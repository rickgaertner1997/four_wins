<!-- app/views/games/show.html.erb -->
<div class="game-page">
  <header class="game-header">
    <h1>Connect Four</h1>

    <div class="game-meta">
      <p><strong>Game ID:</strong> <%= @game.id %></p>

      <% if @game.finished? %>
        <% if @game.draw? %>
          <p class="status finished draw">It's a draw!</p>
        <% else %>
          <p class="status finished">
            Winner:
            <span class="winner"><%= @game.winner == "one" ? "Player One" : "Player Two" %></span>
          </p>
        <% end %>
      <% else %>
        <p class="status ongoing">
          Current turn:
          <span class="<%= @game.current_player %>"><%= @game.current_player == "player_one" ? "Player One" : "Player Two" %></span>
        </p>
      <% end %>

      <p class="moves-count">Moves played: <%= @game.moves_count %></p>
    </div>

    <div class="game-actions">
      <%= link_to "Back to games list", games_path, class: "btn btn-secondary" %>

      <%= button_to "Reset game",
                    reset_game_path(@game),
                    method: :post,
                    class: "btn btn-warning",
                    data: { turbo_confirm: "Are you sure you want to reset this game?" } %>
    </div>
  </header>

  <main class="game-main">
    <% rows = @game.board.first.size %>
    <% cols = @game.board.size %>

    <div class="board-wrapper">
      <table class="board">
        <tbody>
          <% (rows - 1).downto(0) do |row| %>
            <tr>
              <% 0.upto(cols - 1) do |col| %>
                <% cell = @game.board[col][row] %>

                <% css_classes =
                     case cell
                     when 1 then "cell token player-one"
                     when 2 then "cell token player-two"
                     else       "cell token empty"
                     end %>

                <td class="<%= css_classes %>">
                  <div class="token-inner"></div>
                </td>
              <% end %>
            </tr>
          <% end %>

          <!-- Drop buttons row -->
          <tr class="drop-row">
            <% 0.upto(cols - 1) do |col| %>
              <td class="drop-cell">
                <% unless @game.finished? %>
                  <%= button_to "â†“",
                                drop_token_game_path(@game, column_index: col),
                                method: :post,
                                class: "drop-button",
                                form_class: "drop-form" %>
                <% end %>
              </td>
            <% end %>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
