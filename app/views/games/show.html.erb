<h1>Four Wins</h1>

<div class="game-layout">
  <div class="game-sidebar">
    <div class="game-info">
      <p><strong>Game ID:</strong> <%= @game.id %></p>

      <% if @game.finished? %>
        <% if @game.draw? %>
          <p class="status status-draw">It's a draw!</p>
        <% else %>
          <p class="status status-win">
            Winner:
            <%= @game.winner_one? ? "Player One (red)" : "Player Two (yellow)" %>
          </p>
        <% end %>
      <% else %>
        <p class="status status-turn">
          Current turn:
          <%= @game.current_player_player_one? ? "Player One (red)" : "Player Two (yellow)" %>
        </p>
      <% end %>

      <p><strong>Moves:</strong> <%= @game.moves_count %></p>
    </div>

    <div class="game-actions">
      <%= link_to "Back to games list", games_path, class: "btn btn-secondary" %>

      <%= button_to "Reset game", reset_game_path(@game), method: :post,
        data: { turbo_confirm: "Are you sure you want to reset this game?" }, class: "btn btn-danger" %>

    </div>
  </div>

  <div class="game-board-wrapper coin-cursor">
    <!-- TOP BUTTONS -->
    <div class="board-controls">
      <% Game::BOARD_COLUMNS.times do |col| %>
        <% column_full = @game.board[col].none?(0) %>
        <% disabled = @game.finished? || column_full %>

        <%= button_to drop_token_game_path(@game, column_index: col),
                      method: :post,
                      disabled: disabled,
                      class: "column-button",
                      title: "Drop token in column #{col + 1}" do %>
          â–¼
        <% end %>
      <% end %>
    </div>

    <!-- BOARD GRID -->
    <div class="board">
      <% # rows are stored bottom-up (0 is bottom), but top is displayed first %>
      <% (Game::BOARD_ROWS - 1).downto(0) do |row| %>
        <% Game::BOARD_COLUMNS.times do |col| %>
          <% cell = @game.board[col][row] %>

          <% cell_class =
                case cell
                when 1 then "cell token-player-one"
                when 2 then "cell token-player-two"
                else "cell token-empty"
                end %>

          <div class="<%= cell_class %>"></div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
